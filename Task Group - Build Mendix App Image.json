{"tasks":[{"environment":{},"displayName":"Download Mendix Docker Build Pack","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"script":"wget https://github.com/mendix/docker-mendix-buildpack/archive/master.zip\nunzip master.zip\nmv  docker-mendix-buildpack-master/* .\nrm -R  docker-mendix-buildpack-master","workingDirectory":"","failOnStderr":"false"},"task":{"id":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","versionSpec":"2.*","definitionType":"task"}},{"environment":{},"displayName":"Build Docker image for Mendix app","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"containerregistrytype":"Azure Container Registry","dockerRegistryEndpoint":"","azureSubscriptionEndpoint":"$(Azure_Subscription)","azureContainerRegistry":"$(Container_Registry)","action":"Build an image","dockerFile":"**/Dockerfile","buildArguments":"BUILD_PATH=trunk\nAPPMETRICS_PROMETHEUS=true\n","defaultContext":"true","context":"","imageName":"$(Docker_Image_Name)","imageNamesPath":"","qualifyImageName":"true","additionalImageTags":"$(Build.SourceVersion)-$(Build.BuildId)","includeSourceTags":"false","includeLatestTag":"true","imageDigestFile":"","containerName":"","ports":"","volumes":"","envVars":"","workDir":"","entrypoint":"","containerCommand":"","detached":"true","restartPolicy":"no","restartMaxRetries":"","customCommand":"","dockerHostEndpoint":"","enforceDockerNamingConvention":"true","cwd":"$(System.DefaultWorkingDirectory)","memory":""},"task":{"id":"e28912f1-0114-4464-802a-a3a35437fd16","versionSpec":"0.*","definitionType":"task"}},{"environment":{},"displayName":"Push Docker image to Azure Container Registry","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"containerregistrytype":"Azure Container Registry","dockerRegistryEndpoint":"","azureSubscriptionEndpoint":"$(Azure_Subscription)","azureContainerRegistry":"$(Container_Registry)","action":"Push an image","dockerFile":"**/Dockerfile","buildArguments":"","defaultContext":"true","context":"","imageName":"$(Docker_Image_Name)","imageNamesPath":"","qualifyImageName":"true","additionalImageTags":"$(Build.SourceVersion)-$(Build.BuildId)","includeSourceTags":"false","includeLatestTag":"true","imageDigestFile":"","containerName":"","ports":"","volumes":"","envVars":"","workDir":"","entrypoint":"","containerCommand":"","detached":"true","restartPolicy":"no","restartMaxRetries":"","customCommand":"","dockerHostEndpoint":"","enforceDockerNamingConvention":"true","cwd":"$(System.DefaultWorkingDirectory)","memory":""},"task":{"id":"e28912f1-0114-4464-802a-a3a35437fd16","versionSpec":"0.*","definitionType":"task"}},{"environment":{},"displayName":"Remove temporary container (if exists)","alwaysRun":false,"continueOnError":true,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"containerregistrytype":"Azure Container Registry","dockerRegistryEndpoint":"","azureSubscriptionEndpoint":"$(Azure_Subscription)","azureContainerRegistry":"$(Container_Registry)","action":"Run a Docker command","dockerFile":"**/Dockerfile","buildArguments":"","defaultContext":"true","context":"","imageName":"mendix/assetmanager","imageNamesPath":"","qualifyImageName":"true","additionalImageTags":"$(Build.SourceVersion)-$(Build.BuildId)","includeSourceTags":"false","includeLatestTag":"false","imageDigestFile":"","containerName":"mendixapp","ports":"","volumes":"","envVars":"","workDir":"","entrypoint":"/bin/true","containerCommand":"","detached":"true","restartPolicy":"no","restartMaxRetries":"","customCommand":"rm mendixapp","dockerHostEndpoint":"","enforceDockerNamingConvention":"true","cwd":"$(System.DefaultWorkingDirectory)","memory":""},"task":{"id":"e28912f1-0114-4464-802a-a3a35437fd16","versionSpec":"0.*","definitionType":"task"}},{"environment":{},"displayName":"Run temporary container (for extracting metadata.json)","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"containerregistrytype":"Azure Container Registry","dockerRegistryEndpoint":"","azureSubscriptionEndpoint":"$(Azure_Subscription)","azureContainerRegistry":"$(Container_Registry)","action":"Run an image","dockerFile":"**/Dockerfile","buildArguments":"","defaultContext":"true","context":"","imageName":"$(Docker_Image_Name)","imageNamesPath":"","qualifyImageName":"true","additionalImageTags":"$(Build.SourceVersion)-$(Build.BuildId)","includeSourceTags":"false","includeLatestTag":"false","imageDigestFile":"","containerName":"mendixapp","ports":"","volumes":"","envVars":"","workDir":"","entrypoint":"/bin/true","containerCommand":"","detached":"true","restartPolicy":"no","restartMaxRetries":"","customCommand":"","dockerHostEndpoint":"","enforceDockerNamingConvention":"true","cwd":"$(System.DefaultWorkingDirectory)","memory":""},"task":{"id":"e28912f1-0114-4464-802a-a3a35437fd16","versionSpec":"0.*","definitionType":"task"}},{"environment":{},"displayName":"Extract metadata.json from temporary container image","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"containerregistrytype":"Azure Container Registry","dockerRegistryEndpoint":"","azureSubscriptionEndpoint":"$(Azure_Subscription)","azureContainerRegistry":"$(Container_Registry)","action":"Run a Docker command","dockerFile":"**/Dockerfile","buildArguments":"","defaultContext":"true","context":"","imageName":"mendix/assetmanager","imageNamesPath":"","qualifyImageName":"true","additionalImageTags":"$(Build.SourceVersion)-$(Build.BuildId)","includeSourceTags":"false","includeLatestTag":"false","imageDigestFile":"","containerName":"mendixapp","ports":"","volumes":"","envVars":"","workDir":"","entrypoint":"/bin/true","containerCommand":"","detached":"true","restartPolicy":"no","restartMaxRetries":"","customCommand":"cp mendixapp:/build/model/metadata.json $(Build.ArtifactStagingDirectory)","dockerHostEndpoint":"","enforceDockerNamingConvention":"true","cwd":"$(System.DefaultWorkingDirectory)","memory":""},"task":{"id":"e28912f1-0114-4464-802a-a3a35437fd16","versionSpec":"0.*","definitionType":"task"}},{"environment":{},"displayName":"Remove temporary container","alwaysRun":false,"continueOnError":false,"condition":"always()","enabled":true,"timeoutInMinutes":0,"inputs":{"containerregistrytype":"Azure Container Registry","dockerRegistryEndpoint":"","azureSubscriptionEndpoint":"$(Azure_Subscription)","azureContainerRegistry":"$(Container_Registry)","action":"Run a Docker command","dockerFile":"**/Dockerfile","buildArguments":"","defaultContext":"true","context":"","imageName":"mendix/assetmanager","imageNamesPath":"","qualifyImageName":"true","additionalImageTags":"$(Build.SourceVersion)-$(Build.BuildId)","includeSourceTags":"false","includeLatestTag":"false","imageDigestFile":"","containerName":"mendixapp","ports":"","volumes":"","envVars":"","workDir":"","entrypoint":"/bin/true","containerCommand":"","detached":"true","restartPolicy":"no","restartMaxRetries":"","customCommand":"rm mendixapp","dockerHostEndpoint":"","enforceDockerNamingConvention":"true","cwd":"$(System.DefaultWorkingDirectory)","memory":""},"task":{"id":"e28912f1-0114-4464-802a-a3a35437fd16","versionSpec":"0.*","definitionType":"task"}},{"environment":{},"displayName":"Publish Artifact: Docker Image","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"PathtoPublish":"$(Build.ArtifactStagingDirectory)/metadata.json","ArtifactName":"DockerBuild","ArtifactType":"Container","TargetPath":"\\\\my\\share\\$(Build.DefinitionName)\\$(Build.BuildNumber)","Parallel":"false","ParallelCount":"8"},"task":{"id":"2ff763a7-ce83-4e1f-bc89-0ae63477cebe","versionSpec":"1.*","definitionType":"task"}}],"runsOn":["Agent","DeploymentGroup"],"revision":32,"createdBy":{"displayName":"Clyde Waal","id":"5e6f18bd-a1df-60fc-8d14-e20571de9c60","uniqueName":"clyde.waal@Mendix.com"},"createdOn":"2018-07-30T14:28:47.743Z","modifiedBy":{"displayName":"Clyde Waal","id":"5e6f18bd-a1df-60fc-8d14-e20571de9c60","uniqueName":"clyde.waal@Mendix.com"},"modifiedOn":"2019-02-20T18:01:32.687Z","comment":"","id":"30b7bde7-6011-4d15-8135-497b15e9414d","name":"Build Mendix App Image","version":{"major":1,"minor":0,"patch":0,"isTest":false},"iconUrl":"/_static/tfs/20180727T152755/_content/icon-meta-task.png","friendlyName":"Build Mendix App Image","description":"","category":"Build","definitionType":"metaTask","author":"Clyde Waal","demands":[],"groups":[],"inputs":[{"aliases":[],"options":{},"properties":{},"name":"Azure_Subscription","label":"Azure_Subscription","defaultValue":"","required":true,"type":"connectedService:AzureRM","helpMarkDown":"Select an Azure subscription","groupName":""},{"aliases":[],"options":{},"properties":{"EditableOptions":"True"},"name":"Container_Registry","label":"Container_Registry","defaultValue":"","required":true,"type":"pickList","helpMarkDown":"Select an Azure Container Registry in the selected Azure Subscription. The container image will be built and pushed to this container registry.","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"Docker_Image_Name","label":"Docker_Image_Name","defaultValue":"","required":true,"type":"string","helpMarkDown":"Name of the Docker image to build, push, or run.","groupName":""}],"satisfies":[],"sourceDefinitions":[],"dataSourceBindings":[],"instanceNameFormat":"Task group: Build Mendix App Image $(Azure_Subscription)","preJobExecution":{},"execution":{},"postJobExecution":{}}